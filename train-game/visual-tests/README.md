# Тесты для графических функций игры Train Game

Этот каталог содержит тесты для проверки графических функций игры, используя Node.js и библиотеку Canvas для эмуляции HTML Canvas API.

## Структура тестов

- `setup.js` - настройка окружения для тестов, глобальные константы
- `cell-rendering.test.js` - тесты отрисовки отдельных типов клеток
- `track-segments.test.js` - тесты отрисовки сегментов пути из нескольких клеток
- `cell-parameters.test.js` - тесты влияния изменения параметров на отрисовку
- `train-rendering.test.js` - тесты отрисовки поезда в разных позициях и ориентациях
- `background-generation.test.js` - тесты генерации фона игры
- `mock-context.test.js` - тесты с использованием мок-объектов контекста
- `analyze-diffs.js` - скрипт для анализа различий в визуальных тестах

## Как запустить тесты

1. Установите зависимости:

```bash
npm install
```

2. Запустите все тесты:

```bash
npm test
```

3. Запустите только визуальные тесты:

```bash
npm run test:visual
```

## Работа с эталонными изображениями

При первом запуске тесты создадут эталонные изображения в директории `fixtures/`. Эти изображения будут использоваться для сравнения при последующих запусках.

Если вы внесли изменения в графические функции и хотите обновить эталоны:

```bash
npm run test:visual:update
```

## Анализ различий

Если тесты не проходят из-за различий в изображениях, вы можете проанализировать эти различия:

```bash
node analyze-diffs.js
```

Скрипт покажет список файлов с различиями и их расположение.

## Визуальное сравнение

Файлы различий сохраняются с суффиксом `-diff.png` в директории `fixtures/`. Красные пиксели показывают различия между актуальным и эталонным изображением.

## Настройка порога различий

По умолчанию порог различий установлен на 0.1, что означает, что небольшие различия в цвете игнорируются. Вы можете изменить этот порог в `setup.js`. 